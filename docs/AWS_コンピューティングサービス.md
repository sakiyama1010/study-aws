# コンピューティングサービス

## AWS_EC2

Amazon EC2などAWSが提供する仮想サーバーのことを「インスタンス」

- 固有のOSの設定や、AMIに入っていないミドルウェアの導入はユーザーが実施する
- キーペアは、EC2インスタンスに安全に接続するための暗号鍵
  - AWS上に保管されるパブリックキーと、ユーザーの環境上に保管するプライベートキーの2つの鍵で構成される
- プレイスメントグループ
  - 複数のEC2インスタンスを1つのAZに配置してグループ化すること
- クラスタープレイスメントグループ
  - グループ内のEC2インスタンスは物理的に近い距離に配置されるため、通信の遅延が起こりにくく高速な通信が可能
- セキュリティグループ
  - EC2インスタンスに割り当てることによって、ネットワークアクセスを制御するファイアウォール機能のこと
- Amazon マシンイメージ（AMI）
  - EC2インスタンスに展開可能なOSやミドルウェアなどのテンプレート
  - EC2インスタンスはAMIから作成される
- インスタンスタイプ
  - EC2インスタンス作成時に選択できるCPU、メモリ、ストレージ性能、ネットワークキャパシティーの組み合わせ
  - 例：c4.large
- インスタンスファミリー
  - M:汎用
  - T:汎用(CPUバースト機能)
    - 一時的にCPUの高負荷が発生する小中規模のサーバ
  - C:コンピューティング最適化
  - R,X:メモリ最適化
  - P,G,F:高速コンピューティング
  - I,D,H:ストレージ最適化
    - I：高いディスクスループットを必要とするサーバ
- インスタンス世代
  - M5の5の部分
- インスタンスサイズ
  - large
- スポットインスタンス
  - 各AZの予備領域を入札形式で契約することによって、オンデマンドインスタンスよりも割安で利用できる課金形態
    - インスタンスが一部停止しても問題ないシステムに向いている
  - スポットフリート
    - 必要なインスタンス数を指定することで、指定した数のスポットインスタンスが起動
    - スポット価格が入札価格より上回りスポットインスタンスが終了した場合、自動的にインスタンスを補充してインスタンス数を維持する
    - 補充されるインスタンスには、オンデマンドインスタンスも含まれる
  - スポットブロック
    - EC2インスタンスが終了しない時間帯を指定するスポットインスタンスのオプション
- ハードウェア専有インスタンス
  - 他のAWSアカウントとは分離された専用ハードウェアでEC2インスタンスを利用できる購入オプション
  - 物理的なCPUソケット、コア数、ホストIDは確認できない
  - 同AWSアカウントのハードウェア専有インスタンスではないインスタンスと、ハードウェアを共有する可能性がある
  - インスタンス単位で契約する
- オンデマンドインスタンス(**短期向け**)
  - インスタンスの起動時間に基づいた課金形態
  - EC2インスタンスのデフォルトの購入オプション
  - 開発環境など、利用が短期間のシステムに向いている
- リザーブドインスタンス(**長期向け**)
  - 1年もしくは3年の長期契約を結ぶことによって、オンデマンドインスタンスよりも割安で利用できる購入オプション

- ブロックストレージ
  - インスタンスストア
    - EC2インスタンスから利用できる揮発性の（インスタンス稼働中にだけ利用可能な）ブロックストレージ
      - EC2インスタンスを停止・終了すると、保存したデータは削除される
    - 利用料金はEC2に含まれているため、インスタンスストア自体は無料で使用できる
    - 数百万IOPS

- ユーザーデータ(userdata)
  - ユーザーがEC2インスタンス作成時に自動実行させたいコマンドやスクリプト
  - 必須の設定項目ではない
- メタデータ
  - 実行中のインスタンスに関するデータ
    - /latest/meta-data/にアクセスして取得できる
- Dedicated Hosts（専有ホスト）
  - 他のEC2インスタンスとは分離された専用ハードウェアで利用できる購入オプション
  - 利用するソフトウェアライセンスの制約等で分ける必要がある場合

## ELB

- 負荷分散（ロードバランシング）
  - リクエストを処理するリソースを複数配置し、それらのリソースにリクエストの処理を分散する
    - レスポンスの遅延が発生しないようにする
- Elastic Load Balancing（ELB）
  - AWSが提供する負荷分散サービス
  - マネージドサービス
- ターゲット
  - ELB配下の負荷分散先リソースのこと
  - ターゲットにはEC2などのインスタンスや、IPアドレス、Lambda関数が指定できる
- ターゲットグループ
  - 一つのELB配下で管理されるターゲットの集合
  - ターゲットをまとめたターゲットグループ単位に負荷分散を行う
  - AZ障害時の影響を少なくするためにも、ターゲットはマルチAZ（複数のAZに配置する構成）にするのが一般的
- AWS Auto Scaling
  - AWSリソースを負荷状況や設定したスケジュールに従って、自動的にスケーリングする機能
  - ヘルスチェックの猶予期間
    - リソースが起動してから初回のヘルスチェックまでの待機時間
  - 終了ポリシー
    - スケールインが発生したときにリソースを削除する優先順位
      - デフォルト「最も作成時刻が過去の起動設定を利用して起動されたリソース」
      - スケールイン時に特定のリソースが終了されないようにするには、「インスタンスの保護」を有効にする
- スケーリング
  - <https://knowledge.sakura.ad.jp/6217/>

- ALB
  - レイヤー7（アプリケーション層）で負荷分散を行う
  - HTTP、HTTPSをサポート
  - WebSocket
    - ひとつのコネクション内で永続的にサーバー/クライアント双方からデータ送信できる技術
  - 同一インスタンス内の複数ポートへの負荷分散
  - ホストベースのルーティング
    - クライアントがリクエストした接続先URLのFQDNに従ってルーティングできる機能
  - パスベースのルーティング
- NLB
  - レイヤー4（トランスポート層）で負荷分散を行う
  - TCP、UDP、TLSをサポート
  - WebSocket
  - 同一インスタンス内の複数ポートへの負荷分散
  - Elasitc IPアドレス（固定のパブリックIPアドレス）と関連付ける
  - サーバーへのアクセスをドメイン名ではなくIPアドレスで行いたい
  - クライアントのアクセス先をIPアドレスで管理・制限している環境で使いたい
  - NLBのターゲットにALBを指定できる
    - クライアントからALB配下のサーバーにNLBのElastic IPアドレスでアクセスできる
- CLB
  - レイヤー7（アプリケーション層）およびレイヤー4（トランスポート層）で負荷分散を行う
  - HTTP、HTTPS、TCP、SSL/TLSをサポート
  - ALBやNLBより古いサービスでパフォーマンスが劣る
    - 基本的にはALBやNLBの利用が推奨されている
