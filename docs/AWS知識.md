# AWS知識

## クラウド知識

- サービスモデル
  - SaaS (Software as a Service)
    - アプリケーションを含むすべての機能を提供するサービス
  - PaaS (Platform as a Service)
    - OSやミドルウェア、ランタイムなどのアプリケーション実行環境を含むプラットフォームを提供するサービス
  - IaaS(Infrastructure as a Service)
    - ネットワークやストレージを含むサーバー機能を提供するサービス
    - ユーザーはサーバーのスペックを選択し、OSやミドルウェアの導入する

## AWSについて

- AWSのリソースを操作する手段
  - AWSマネジメントコンソール
  - AWSコマンドラインインターフェイス（awscli）
  - SDK
- セキュリティ
  - セキュリティ対策の責任をAWSとユーザーで分担する「責任共有モデル」
  - AWS責任を持って管理するもの
    - AWSのサービスが稼働するハードウェアのセキュリティ対策
      - ネットワーク機器のファームウェアのバージョンアップ
      - 不要になった物理ディスクの破棄
    - AWSのサービスが稼働するデータセンターのセキュリティ対策
      - データセンターの入退室管理
    - ハイパーバイザー（ホストOS）のパッチ適用、セキュリティ対策
      - 仮想化環境を実現するための土台となる仮想化ソフトウェアやOSのこと
      - ハイパーバイザーなどの仮想環境上で動作するOSのことを「ゲストOS」
      - ハイパーバイザー（ホストOS）へのセキュリティパッチの適用
  - ユーザー責任
    - AWSサービスを利用するにあたって作成した認証情報
    - AWSサービスへのアクセス権限
      - ユーザーが作成したAWSアカウントの管理
    - 仮想サーバー上のデータやログ
      - ユーザーが保存したデータの暗号化
      - データベース監査ログの管理
      - **ゲストOS**へのセキュリティパッチの適用
- Well-Architected Framework
  - AWSが提唱するクラウド設計・運用のベストプラクティス集
  - 「一般的な設計原則」に従った設計
    - システムの作成や複製の処理を自動化することで、新機能の適用や動作確認といった実験的な作業が容易にできる
- エッジロケーション
  - ユーザーと直接通信するAWSデータセンター
- アベイラビリティーゾーン
  - リージョン内の物理的および論理的に区切られたデータセンター（群）
- リージョン
  - 世界中のAWSデータセンターを地域で区切ったもの
- グローバル
  - 全世界で共通して利用できるAWSサービスの範囲

## DNS

### Route 53

- ルーティングポリシー
  - DNSクエリ（名前解決依頼）のドメイン名に対応するIPアドレスの中から回答するIPアドレスを決める方針のこと
- ルーティングポリシー種類
  - シンプルルーティングポリシー
    - ドメイン名に紐づいた単一のIPアドレスを回答
    - シンプルルーティングポリシー以外は、複数のルーティングポリシーを組み合わせることができる
  - 加重ルーティングポリシー
    - 複数のIPアドレスに対して**設定された重みづけに従って**IPアドレスを回答
  - レイテンシールーティングポリシー
    - 遅延（レイテンシー）が最も小さいリージョンにあるリソースのIPアドレスを回答
    - 基本的にクライアントから最も近いリージョンにあるリソースが選ばれますが、リソースまでの経路に遅延が発生している場合は、他の遅延が少ないリージョンにあるリソースが選ばれる
  - 位置情報ルーティングポリシー
    - クライアントの位置情報に基づいて、IPアドレスを回答
    - 例えばクライアントの位置情報から、クライアントの使用言語に合ったコンテンツがあるリソースのIPアドレスを回答する
  - 地理的近接性ルーティングポリシー
    - クライアントの位置情報を元に、クライアントと**地理的に近いリージョン**にあるリソースのIPアドレスを回答
  - 複数値回答ルーティングポリシー
    - 複数のリソースに対してヘルスチェックを行い、最大8個の正常なリソースの中からランダムに分散してIPアドレスを回答
    - ヘルスチェックの設定が必須
  - フェイルオーバールーティングポリシー
    - 通常時にアクセスさせたいリソースをプライマリに設定
    - プライマリに障害が発生した場合にアクセスさせたいリソースをセカンダリに設定
    - 通常時はプライマリに設定したリソースのIPアドレスを回答
    - プライマリのリソースにヘルスチェックで異常が発生した場合は、セカンダリに設定したリソースのIPアドレスを回答
      - リソースがプライマリからセカンダリへ自動的に切り替わる仕組みのことを「フェイルオーバー」という
    - ヘルスチェックの設定が必須

## 権限

### AWS IAM（Identity and Access Management）

- IAMポリシー
  - IAMユーザー、IAMグループに対して権限を付与できる
- AWS Organizations
  - 複数のAWSアカウントをまとめて管理する機能
  - 管理するAWSアカウントに対して権限設定
  - 管理するAWSアカウントへの請求情報をひとまとめにする
  - Organizationsでは複数の組織を階層構造で管理する

### AWS KMS（Key Management Service）

- 暗号化に使用する鍵（キー）を作成・管理するサービス
  - 暗号化を行う対象のサービス（Amazon S3やEBS（Elastic Block Store）、Amazon Redshiftなど）と連携して利用
  - 暗号化鍵をAWSクラウド上で管理する
  - 暗号化鍵の管理はAWSによって行われる

## ストレージ

### Amazon EFS

- **ファイルストレージ**サービス
  - Amazon FSx
    - Amazon FSx For Windowsファイルサーバー
      - SMBプロトコルを介してWindows Server（OS）上に構築されたファイルシステムを提供
      - フルマネージド
      - Windowsサーバーが提供する既存機能を利用
        - DFSR:共有フォルダ間を関連付けて自動的に複製する機能
    - Amazon FSx For Lustre

### Amazon EBS（Elastic Block Store）

- EC2インスタンスに割り当てられる**ブロックストレージ**
  - EC2インスタンスにアタッチ（取り付け）して利用
  - 作成したボリュームは1つのEC2インスタンスだけにアタッチできる
  - 同時に2つ以上のインスタンスからアクセスすることはできない
    - 一部のボリュームタイプでは複数インスタンスのアタッチ（マルチアタッチ）に対応してるが
    - 利用できるインスタンスタイプやリージョンが限られている
- 物理ハードディスクドライブと同じように利用する
- ボリュームタイプ
  - 汎用SSD
  - プロビジョンドOPS SSD(io1)
  - プロビジョンドOPS SSD(io2)
  - スループット最適化 HDD(st1)
  - コールドHDD(sc1)

### S3

## ログ

### Amazon CloudWatch

- メトリクス
  - 標準メトリクス
    - CPU使用率、ディスクIO、ネットワーク使用率
  - カスタムメトリクス
    - メモリ使用量
    - ディスクの空き容量、使用状況
    - プロセス情報

## CDN

### CloudFront

- S3内に保存しているコンテンツをAmazon CloudFrontを使用して配信したい。ただしコンテンツの配信期間は7日間とし、配信先を特定のクライアントに限定する。
  - loudFront署名付きURLを有効期限7日間に設定して発行し、OAIを有効にする
- OAI（Origin Access Identity）
  - 3バケット内のコンテンツへのアクセスをCloudFront経由でのアクセスに限定し、クライアントからS3バケットへ直接アクセスされないようにする機能
- 世界各地の配信サーバー（エッジサーバー）がオリジナルデータがあるサーバー（オリジンサーバー）のコンテンツをコピーして保管（キャッシュ）する
  - 世界各地のクライアントに対してWebコンテンツを低遅延で配信できる

## 料金仕様

- リージョン
  - EC2 を扱うときに料金形態が変わる

VPCにいるだけで利用料金がかかってしまうリソース
<https://fu3ak1.hatenablog.com/entry/2020/07/02/233639>

### AWS サービスがどこにあるのか

<https://qiita.com/saitotak/items/d2ede050e7a2224da46d>

- グローバルサービス
- リージョンサービス
- AZ サービス

### DNS知識

<https://www.atmarkit.co.jp/fnetwork/rensai/dns01/dns-record.html>

- SOA : ゾーン（ドメイン）情報を記載
- NS : ドメインのDNSサーバ名を指定
- A : ホストのIPアドレス
- CNAME : ホスト名のエイリアス（別名
- MX : ドメインのメール・サーバ名
- TXT : ホストへのテキスト情報
Zone Apexとは、頭にサブドメインを伴わない、ドメイン名自体のこと。当該DNSゾーンの中で頂点（apex）にあたるドメイン名であるためこのように呼ばれる。

- CloudFront
  - CDNサービス
  - 利用者から最も近いエッジロケーション(データセンター)から配信される
  - 配信元となるオリジンサーバが必要
  - ディストリビューション(distribution 流通・分布)
    - ダウンロード(HTTP/HTTPSを用いたCSSや画像の配信)
    - ストリーミング(RTMPを用いた動画配信)
  - キャッシュルール
    - 拡張子やパスを指定してキャッシュ期間の指定が可能

- route 53
  - ドメイン管理、権威DNS
  - ドメイン取得からゾーン設定が可能
  - ドメインの年間利用料はAWS利用料に含まれる
    - 自動更新機能有
    - 権威DNS
      - あるゾーンの情報を保持し、他のサーバーに問い合わせることなく応答を返すことができるサーバーのこと
      - ドメインとIPの変換情報を保持したDNS
      - 変換情報を保持していないDNSをキャッシュDNSという
      - 保持した情報以外はリクエストしても応答しない
    - ホストゾーン
      - レコード情報の管理単位(基本ドメイン単位)
      - Aliasレコード
        - CloudFrontやELB,S3等のAWSリソースのFQDNを指定できる
      - NSレコード
        - Route53で作成した場合は、AWSのネームサーバが自動で設定される
      - ZONE APEX
        - route53の場合、ホストゾーン名
  - ルーティングポリシー
    - シンプル
      - 1対1
    - フェイルオーバー
      - ヘルスチェック失敗時にスタンバイ用のシステムへルーティングする
      - 障害発生時
    - 位置情報
      - ユーザーの位置情報でルーティングする
      - アクセス場所によって言語を変える
    - 地理的近接性
      - リソースの場所でルーティングする
      - トラフィックのある場所のリソースから別の場所のリソースに移動する
        - 例：AWS リソースを使用している場合は、リソースを作成した AWS リージョン
      - 使用するには、Route 53 トラフィックフロー.を使用する必要がある
    - レイテンシー
      - 遅延の最もすｋ内サーバにリクエストをルーティングする
    - 複数値回答
      - 1つのレコードに異なるIPを複数登録してランダムに返却されたIPへルーティングする
      - ヘルスチェックNGのサーバにはルーティングしない
      - 最大8つ
    - 加重
      - 指定した比率でルーティングする
      - リクエスト比率を調整する
  - トラフィックフロー
    - ルーティングエディタ(GUI)的な
  - DNSフェイルオーバー
    - route53のフォールトトレラント技術
      - サーバ停止被害を最小限に抑える仕組み

- CloudFormation
  - !Ref
    - テンプレートファイル内で指定したリソースの値を参照する
  - DependsOn
    - 特定リソースが他のリソースに続けて作成されるように指定する
